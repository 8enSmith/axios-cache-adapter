!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("axios"),require("axios/lib/core/settle"),require("lodash/partial"),require("lodash/extend"),require("lodash/omit")):"function"==typeof define&&define.amd?define(["axios","axios/lib/core/settle","lodash/partial","lodash/extend","lodash/omit"],t):e.axiosCacheAdapter=t(e.axios,e.settle,e.partial,e.extend,e.omit)}(this,function(e,t,r,n,o){"use strict";function a(e,t){return o(t,["request","config"])}function u(e,t){if(void 0===t&&(t={}),"function"==typeof t.filter&&!t.filter(e))return!0;if(t.query&&e.url.match(/\?.*$/))return!0;var r=!1;return(t.paths||[]).forEach(function(t){if(e.url.match(t))return r=!0}),!!r}function c(n){function o(e,t,r){if(2!==(r.status/100|0))return r;if(["arraybuffer","blob"].indexOf(r.responseType)>-1)return r;var o=0===n.maxAge?0:Date.now()+n.maxAge;return n.store.setItem(t,{expires:o,data:n.serialize(e,r)}).then(function(){return r})}function c(e){console.log("[cache.request] Starting cache execution",e);var t=f(e),a=r(o,e,t);if(u(e,n.exclude))return Promise.reject(a);var c=e.method.toLowerCase();return"head"===c?Promise.reject(a):"get"!==c?(n.store.removeItem(t),Promise.reject(a)):n.store.getItem(t).then(function(r){return console.log("[cache.request]",t,r),n.readCache(e,n.log)(r).then(function(t){return console.log("[cache.readCache]",t),t.config=e,t.request={fromCache:!0},t}).catch(function(e){return n.clearOnStale&&"cache-stale"===e.reason?n.store.removeItem(t).then(function(){return Promise.reject(a)}):Promise.reject(a)})})}void 0===n&&(n={}),n.store=n.store||new l;var f=n.key||i;return n.maxAge=n.maxAge||0,n.readCache=n.readCache||s,n.serialize=n.serialize||a,n.clearOnStale=void 0===n.clearOnStale||n.clearOnStale,n.exclude=n.exclude||{},n.exclude.query=n.exclude.query||!0,n.exclude.paths=n.exclude.paths||[],n.exclude.filter=null,!1!==n.log&&(n.log="function"==typeof n.log?n.log:console.log.bind(console)),{adapter:function(r){return console.log(r),new Promise(function(n,o){return c(r).then(function(e){return console.log("[request] Settling",e),t(n,o,e)}).catch(function(a){return console.log("[request] Caught cache reading",a),e.defaults.adapter(r).then(a).then(function(e){return t(n,o,e)})})})},readCache:s,serialize:a}}function i(e){return e.url}e=e&&e.hasOwnProperty("default")?e.default:e,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,n=n&&n.hasOwnProperty("default")?n.default:n,o=o&&o.hasOwnProperty("default")?o.default:o;var s=function(e,t){return function(r){return new Promise(function(n,o){if(!r||!r.data){t("cache-miss",e.url);var a=new Error;return a.reason="cache-miss",a.message="Value not found from cache",o(a)}var u=r.expires,c=r.data;if(0!==u&&u<Date.now()){t("cache-stale",e.url);var i=new Error;return i.reason="cache-stale",i.message="Value is stale",o(i)}return n(c)})}},l=function(){this._store={}};l.prototype.getItem=function(e){return Promise.resolve(this._store[e]||null)},l.prototype.setItem=function(e,t){return this._store[e]=t,Promise.resolve(t)},l.prototype.clear=function(){return this._store={},Promise.resolve()};var f={cache:{maxAge:9e5}};return{setupCache:c,setup:function(t){var r=c((t=n({},f,t)).cache);return e.create({adapter:r.adapter})}}});
