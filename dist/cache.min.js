!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("axios"),require("axios/lib/core/settle"),require("lodash/partial"),require("lodash/extend"),require("lodash/omit")):"function"==typeof define&&define.amd?define(["axios","axios/lib/core/settle","lodash/partial","lodash/extend","lodash/omit"],r):e.axiosCacheAdapter=r(e.axios,e.settle,e.partial,e.extend,e.omit)}(this,function(e,r,t,n,a){"use strict";function o(e,r){return a(r,["request","config"])}function u(e,r){if(void 0===r&&(r={}),"function"==typeof r.filter&&!r.filter(e))return!0;if(r.query&&e.url.match(/\?.*$/))return!0;var t=!1;return(r.paths||[]).forEach(function(r){if(e.url.match(r))return t=!0}),!!t}function i(n){function a(e,r,t){if(2!==(t.status/100|0))return t;if(["arraybuffer","blob"].indexOf(t.responseType)>-1)return t;var a=0===n.maxAge?0:Date.now()+n.maxAge;return n.store.setItem(r,{expires:a,data:n.serialize(e,t)}).then(function(){return t})}function i(e){var r=l(e),o=t(a,e,r);if(u(e,n.exclude))return Promise.reject(o);var i=e.method.toLowerCase();return"head"===i?Promise.reject(o):"get"!==i?(n.store.removeItem(r),Promise.reject(o)):n.store.getItem(r).then(function(t){return n.readCache(e,n.debug)(t).then(function(r){return r.config=e,r.request={fromCache:!0},r}).catch(function(e){return n.clearOnStale&&"cache-stale"===e.reason?n.store.removeItem(r).then(function(){return Promise.reject(o)}):Promise.reject(o)})})}void 0===n&&(n={}),n.store=n.store||new c;var l=n.key||function(e){return e.url};return n.maxAge=n.maxAge||0,n.readCache=n.readCache||s,n.serialize=n.serialize||o,n.clearOnStale=void 0===n.clearOnStale||n.clearOnStale,n.debug=n.debug||!1,n.exclude=n.exclude||{},n.exclude.query=n.exclude.query||!0,n.exclude.paths=n.exclude.paths||[],n.exclude.filter=n.exclude.filter||null,!1!==n.debug&&(n.debug="function"==typeof n.debug?n.debug:console.log.bind(console)),{adapter:function(t){return new Promise(function(n,a){return i(t).then(function(e){return r(n,a,e)}).catch(function(o){return e.defaults.adapter(t).then(o).then(function(e){return r(n,a,e)})})})},store:n.store}}e=e&&e.hasOwnProperty("default")?e.default:e,r=r&&r.hasOwnProperty("default")?r.default:r,t=t&&t.hasOwnProperty("default")?t.default:t,n=n&&n.hasOwnProperty("default")?n.default:n,a=a&&a.hasOwnProperty("default")?a.default:a;var s=function(e,r){return function(t){return new Promise(function(n,a){if(!t||!t.data){r("cache-miss",e.url);var o=new Error;return o.reason="cache-miss",o.message="Value not found from cache",a(o)}var u=t.expires,i=t.data;if(0!==u&&u<Date.now()){r("cache-stale",e.url);var s=new Error;return s.reason="cache-stale",s.message="Value is stale",a(s)}return r("cache-hit",e.url),n(i)})}},c=function(){this._store={}};c.prototype.getItem=function(e){return Promise.resolve(this._store[e]||null)},c.prototype.setItem=function(e,r){return this._store[e]=r,Promise.resolve(r)},c.prototype.clear=function(){return this._store={},Promise.resolve()};var l={cache:{maxAge:9e5}};return{setupCache:i,setup:function(r){var t=i((r=n({},l,r)).cache),o=a(r,["cache"]);return e.create(n({},o,{adapter:t.adapter}))}}});
