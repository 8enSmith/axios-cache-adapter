{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap ed557f8663e737f8279e","webpack:///./lib/index.js","webpack:///./lib/read-cache.js","webpack:///./lib/hydrate.js","webpack:///./lib/serialize.js","webpack:///./lib/memory.js","webpack:///./lib/exclude.js"],"names":[],"mappings":"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","file":"superapi-cache.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"superapi-cache\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"superapi-cache\"] = factory();\n\telse\n\t\troot[\"superapi-cache\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap ed557f8663e737f8279e\n **/","'use strict'\n\nimport readCache from './read-cache'\nimport serialize from './serialize'\nimport memoryStore from './memory'\nimport exclude from './exclude'\n\nfunction cache (config = {}) {\n  config.store = config.store || memoryStore\n  const key = config.key || cache.key\n\n  config.maxAge = config.maxAge || 0\n  config.readCache = config.readCache || readCache\n  config.serialize = config.serialize || serialize\n\n  config.exclude = config.exclude || {}\n  config.exclude.query = config.exclude.query || true\n  config.exclude.paths = config.exclude.paths || []\n  config.exclude.filter = null\n\n  if (config.log !== false) {\n    config.log = typeof config.log === 'function' ? config.log : console.log.bind(console)\n  }\n\n  return (req, next, service) => {\n    if (exclude(req, service, config.exclude)) {\n      return null\n    }\n\n    const uuid = key(req)\n\n    // clear cache if method different from GET\n    if (req.method.toLowerCase() !== 'get') {\n      config.store.removeItem(uuid)\n      return null\n    }\n\n    const f = () => {\n      return next()\n        .then(res => {\n          const type = res.status / 100 | 0\n\n          // only cache 2xx response\n          if (type !== 2) {\n            return res\n          }\n\n          return config.store.setItem(uuid, {\n            expires: config.maxAge === 0 ? 0 : Date.now() + config.maxAge,\n            data: config.serialize(req, res)\n          })\n        })\n    }\n\n    return config.store.getItem(uuid).then(value => {\n      return config.readCache(req, config.log)(value)\n        .catch(err => {\n          // clean up cache if stale\n          err.reason === 'cache-stale' ? config.store.removeItem(uuid).then(f) : f()\n        })\n    })\n  }\n}\n\ncache.readCache = readCache\ncache.serialize = serialize\n\ncache.key = function (req) {\n  return req.url\n}\n\nexport default cache\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/index.js\n **/","import hydrate from './hydrate'\n\nexport default function (req, log) {\n  return function (value) {\n    return new Promise((resolve, reject) => {\n      if (!value || !value.data) {\n        log('cache-miss', req.url)\n        const error = new Error()\n\n        error.reason = 'cache-miss'\n        error.message = 'Value not found from cache'\n        return reject(error)\n      }\n\n      const { expires, data } = value\n\n      if (expires !== 0 && (expires < Date.now())) {\n        log('cache-stale', req.url)\n        const error = new Error()\n\n        error.reason = 'cache-stale'\n        error.message = 'Value is stale'\n        return reject(error)\n      }\n\n      // hydrate pseudo xhr from cached value\n      req.xhr = hydrate(data)\n\n      // override request end callback\n      req.callback = (err, res) => {\n        log('cache-hit', req.url)\n\n        if (err) {\n          return reject(err, res)\n        }\n\n        resolve(res)\n      }\n\n      req.emit('end')\n    })\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/read-cache.js\n **/","/**\nvalue should have the following format\n{\n  body: {\n    responseType: '',\n    responseText: value,\n    status: '',\n    statusText: ''\n  },\n  headers: ''\n}\n*/\n\n// borrow from superagent\nfunction trim (s = '') {\n  return ''.trim ? s.trim(s) : s.replace(/(^\\s*|\\s*$)/g, '')\n}\n\n// borrow from superagent\nfunction parseHeaders (str = '') {\n  const lines = str.split(/\\r?\\n/)\n  let fields = {}\n  let index\n  let line\n  let field\n  let val\n\n  lines.pop() // trailing CRLF\n\n  for (let i = 0, len = lines.length; i < len; i += 1) {\n    line = lines[i]\n    index = line.indexOf(':')\n    field = line.slice(0, index).toLowerCase()\n    val = trim(line.slice(index + 1))\n    fields[field] = val\n  }\n\n  return fields\n}\n\nexport default function hydrate (value) {\n  const xhr = value.body || {}\n  const headers = parseHeaders(value.headers)\n\n  xhr.getAllResponseHeaders = function () {\n    return value.headers\n  }\n\n  xhr.getResponseHeader = function (header) {\n    return headers[header]\n  }\n\n  return xhr\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/hydrate.js\n **/","export default function serialize (req, res) {\n  return {\n    headers: res.xhr.getAllResponseHeaders(),\n    body: {\n      responseType: res.xhr.responseType,\n      responseText: res.xhr.responseText,\n      status: res.status,\n      statusText: res.statusText\n    }\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/serialize.js\n **/","class MemoryStore {\n  constructor () {\n    this._store = {}\n  }\n\n  getItem (key) {\n    return Promise.resolve(this._store[key] || null)\n  }\n\n  setItem (key, value) {\n    this._store[key] = value\n    return Promise.resolve(value)\n  }\n\n  clear () {\n    this._store = {}\n    return Promise.resolve()\n  }\n}\n\nexport default MemoryStore\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/memory.js\n **/","\nexport default function exclude (req, service, exclusions = {}) {\n  if (service) {\n    if (service.use && service.use.cache === false) {\n      return true\n    }\n  }\n\n  if ((typeof exclusions.filter === 'function') && !exclusions.filter(req)) {\n    return true\n  }\n\n  // do not cache request with query\n  if (exclusions.query && req.url.match(/\\?.*$/)) {\n    return true\n  }\n\n  let found = false\n  const paths = exclusions.paths || []\n\n  paths.forEach(regexp => {\n    if (req.url.match(regexp)) {\n      found = true\n      return found\n    }\n  })\n\n  if (found) {\n    return true\n  }\n\n  // All rules explained. fo not rewrite regexp.\n  return false\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/exclude.js\n **/"],"sourceRoot":""}