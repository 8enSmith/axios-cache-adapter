{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///superapi-cache.min.js","webpack:///webpack/bootstrap a1f00da3968cb843e2e2","webpack:///./lib/index.js","webpack:///./lib/read-cache.js","webpack:///./lib/hydrate.js","webpack:///./lib/serialize.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","cache","config","arguments","length","undefined","store","Error","key","readCache","_readCache2","serialize","_serialize2","log","console","bind","req","next","service","useCache","use","f","then","res","setItem","getItem","value","err","Object","defineProperty","_readCache","_serialize","url","Promise","resolve","reject","error","reason","message","callback","xhr","_hydrate2","emit","_hydrate","trim","s","replace","parseHeader","str","index","line","field","val","lines","split","fields","pop","i","len","indexOf","slice","toLowerCase","hydrate","body","headers","getAllResponseHeaders","getResponseHeader","header","responseType","responseText","status","statusText"],"mappings":"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","file":"superapi-cache.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"superapi-cache\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"superapi-cache\"] = factory();\n\telse\n\t\troot[\"superapi-cache\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"superapi-cache\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"superapi-cache\"] = factory();\n\telse\n\t\troot[\"superapi-cache\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _readCache = __webpack_require__(1);\n\t\n\tvar _readCache2 = _interopRequireDefault(_readCache);\n\t\n\tvar _serialize = __webpack_require__(3);\n\t\n\tvar _serialize2 = _interopRequireDefault(_serialize);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction cache() {\n\t  var config = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\t\n\t  if (!config.store) {\n\t    throw new Error('Cache middleware need to be provided a store.');\n\t  }\n\t\n\t  var store = config.store;\n\t  var key = config.key || cache.key;\n\t\n\t  config.readCache = config.readCache || _readCache2.default;\n\t  config.serialize = config.serialize || _serialize2.default;\n\t\n\t  if (config.log !== false) {\n\t    config.log = typeof config.log === 'function' ? config.log : console.log.bind(console);\n\t  }\n\t\n\t  return function (req, next, service) {\n\t    if (service) {\n\t      var useCache = !service.use || service.use && service.use.cache !== false;\n\t\n\t      if (!useCache) {\n\t        return null;\n\t      }\n\t    }\n\t\n\t    var f = function f() {\n\t      return next().then(function (res) {\n\t        return store.setItem(key(req), config.serialize(req, res));\n\t      });\n\t    };\n\t\n\t    return store.getItem(key(req)).then(function (value) {\n\t      return config.readCache(req, config.log)(value).catch(function (err) {\n\t        // eslint-disable-line handle-callback-err\n\t        f();\n\t      });\n\t    });\n\t  };\n\t}\n\t\n\tcache.readCache = _readCache2.default;\n\tcache.serialize = _serialize2.default;\n\t\n\tcache.key = function (req) {\n\t  return req.url;\n\t};\n\t\n\texports.default = cache;\n\tmodule.exports = exports['default'];\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\texports.default = function (req, log) {\n\t  return function (value) {\n\t    return new Promise(function (resolve, reject) {\n\t      if (!value) {\n\t        log('cache-miss', req.url);\n\t        var error = new Error();\n\t\n\t        error.reason = 'cache-miss';\n\t        error.message = 'Value not found from cache';\n\t        return reject(error);\n\t      }\n\t\n\t      // override request end callback\n\t      req.callback = function (err, res) {\n\t        log('cache-hit', req.url);\n\t\n\t        if (err) {\n\t          return reject(err, res);\n\t        }\n\t\n\t        resolve(res);\n\t      };\n\t\n\t      // hydrate pseudo xhr from cached value\n\t      req.xhr = (0, _hydrate2.default)(value);\n\t      req.emit('end');\n\t    });\n\t  };\n\t};\n\t\n\tvar _hydrate = __webpack_require__(2);\n\n\tvar _hydrate2 = _interopRequireDefault(_hydrate);\n\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n\tmodule.exports = exports['default'];\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = hydrate;\n\t/**\n\tvalue should have the following format\n\t{\n\t  body: {\n\t    responseType: '',\n\t    responseText: value,\n\t    status: '',\n\t    statusText: ''\n\t  },\n\t  headers: ''\n\t}\n\t*/\n\t\n\t// borrow from superagent\n\tfunction trim(s) {\n\t  return ''.trim ? s.trim(s) : s.replace(/(^\\s*|\\s*$)/g, '');\n\t}\n\t\n\t// borrow from superagent\n\tfunction parseHeader(str) {\n\t  var lines = str.split(/\\r?\\n/);\n\t  var fields = {};\n\t  var index;\n\t  var line;\n\t  var field;\n\t  var val;\n\t\n\t  lines.pop(); // trailing CRLF\n\t\n\t  for (var i = 0, len = lines.length; i < len; i += 1) {\n\t    line = lines[i];\n\t    index = line.indexOf(':');\n\t    field = line.slice(0, index).toLowerCase();\n\t    val = trim(line.slice(index + 1));\n\t    fields[field] = val;\n\t  }\n\t\n\t  return fields;\n\t}\n\t\n\tfunction hydrate(value) {\n\t  var xhr = value.body || {};\n\t  var headers = parseHeader(value.headers || {});\n\t\n\t  xhr.getAllResponseHeaders = function () {\n\t    return value.headers;\n\t  };\n\t\n\t  xhr.getResponseHeader = function (header) {\n\t    return headers[header];\n\t  };\n\t\n\t  return xhr;\n\t}\n\tmodule.exports = exports['default'];\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\texports.default = serialize;\n\tfunction serialize(req, res) {\n\t  return {\n\t    headers: res.xhr.getAllResponseHeaders(),\n\t    body: {\n\t      responseType: res.xhr.responseType,\n\t      responseText: res.xhr.responseText,\n\t      status: res.status,\n\t      statusText: res.statusText\n\t    }\n\t  };\n\t}\n\tmodule.exports = exports['default'];\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** superapi-cache.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap a1f00da3968cb843e2e2\n **/","'use strict'\n\nimport readCache from './read-cache'\nimport serialize from './serialize'\n\nfunction cache (config = {}) {\n  if (!config.store) {\n    throw new Error('Cache middleware need to be provided a store.')\n  }\n\n  const store = config.store\n  const key = config.key || cache.key\n\n  config.readCache = config.readCache || readCache\n  config.serialize = config.serialize || serialize\n\n  if (config.log !== false) {\n    config.log = typeof config.log === 'function' ? config.log : console.log.bind(console)\n  }\n\n  return (req, next, service) => {\n    if (service) {\n      const useCache = !service.use || (service.use && (service.use.cache !== false))\n\n      if (!useCache) {\n        return null\n      }\n    }\n\n    const f = () => {\n      return next()\n        .then(res => {\n          return store.setItem(key(req), config.serialize(req, res))\n        })\n    }\n\n    return store.getItem(key(req)).then(value => {\n      return config.readCache(req, config.log)(value)\n        .catch(err => { // eslint-disable-line handle-callback-err\n          f()\n        })\n    })\n  }\n}\n\ncache.readCache = readCache\ncache.serialize = serialize\n\ncache.key = function (req) {\n  return req.url\n}\n\nexport default cache\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/index.js\n **/","import hydrate from './hydrate'\n\nexport default function (req, log) {\n  return function (value) {\n    return new Promise((resolve, reject) => {\n      if (!value) {\n        log('cache-miss', req.url)\n        const error = new Error()\n\n        error.reason = 'cache-miss'\n        error.message = 'Value not found from cache'\n        return reject(error)\n      }\n\n      // override request end callback\n      req.callback = (err, res) => {\n        log('cache-hit', req.url)\n\n        if (err) {\n          return reject(err, res)\n        }\n\n        resolve(res)\n      }\n\n      // hydrate pseudo xhr from cached value\n      req.xhr = hydrate(value)\n      req.emit('end')\n    })\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/read-cache.js\n **/","/**\nvalue should have the following format\n{\n  body: {\n    responseType: '',\n    responseText: value,\n    status: '',\n    statusText: ''\n  },\n  headers: ''\n}\n*/\n\n// borrow from superagent\nfunction trim (s) {\n  return ''.trim ? s.trim(s) : s.replace(/(^\\s*|\\s*$)/g, '')\n}\n\n// borrow from superagent\nfunction parseHeader (str) {\n  var lines = str.split(/\\r?\\n/)\n  var fields = {}\n  var index\n  var line\n  var field\n  var val\n\n  lines.pop() // trailing CRLF\n\n  for (let i = 0, len = lines.length; i < len; i += 1) {\n    line = lines[i]\n    index = line.indexOf(':')\n    field = line.slice(0, index).toLowerCase()\n    val = trim(line.slice(index + 1))\n    fields[field] = val\n  }\n\n  return fields\n}\n\nexport default function hydrate (value) {\n  const xhr = value.body || {}\n  const headers = parseHeader(value.headers || {})\n\n  xhr.getAllResponseHeaders = function () {\n    return value.headers\n  }\n\n  xhr.getResponseHeader = function (header) {\n    return headers[header]\n  }\n\n  return xhr\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/hydrate.js\n **/","export default function serialize (req, res) {\n  return {\n    headers: res.xhr.getAllResponseHeaders(),\n    body: {\n      responseType: res.xhr.responseType,\n      responseText: res.xhr.responseText,\n      status: res.status,\n      statusText: res.statusText\n    }\n  }\n}\n\n\n\n/** WEBPACK FOOTER **\n ** ./lib/serialize.js\n **/"],"sourceRoot":""}